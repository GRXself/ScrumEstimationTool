@model object

@{
    ViewBag.Title = "Scrum Estimation Tool: Host";
    Layout = "_Layout";
}

<script type="text/javascript">
    window.onload = LoadHostPage;

    function GetCurrentEstimationResult() {
      if (IsRoomIdEmpty()) {
        return;
      }
      
      $.ajax({
        url: '@Url.Action("GetCurrentEstimationResult", "Host")',
        type: 'POST',
        data: {
            
        },
        success: function(currentEstimationResult) {
          if (currentEstimationResult.expired === true)
          {
            alert("Session expired! Please create a new room.")
          }
          else{
            if (confirm(currentEstimationResult.count + " guys voted, show result?" +
             "\rCurrent participants: \r" + currentEstimationResult.participantsName))
            {
              const estimationResultShowArea = $('#estimation-result-content');
              estimationResultShowArea.text("");
              for (const singleEstimation of currentEstimationResult.estimations) 
              {
                estimationResultShowArea.append(singleEstimation + "<br/>");
              }
            }
          }
        }
      })
    }
    
    function Reset() {
      if (confirm("Reset?")) {
        $.ajax({
          url: '@Url.Action("ResetEstimation", "Host")',
          type: 'POST',
          data: {
              
          },
          success: function(resetResult) {
            $('#estimation-result-content').text("Estimation Refreshed.");
          }
        })
      }
    }
    
    function copySharedLink() {
      /* Get the text field */
      var copyText = $('#room-link');
    
      /* Select the text field */
      copyText.select();
    
      /* Copy the text inside the text field */
      document.execCommand("copy");
    }
</script>

<style>
.host-panel {
  float:left;
  padding: 30px;
  width: 50%;
}
.link-show {
  width: 100%;
}
</style>

<h2>Host</h2>

<div>
  <div class="host-panel" style="border-right: 5px solid">
    <div>
      Current room id:
      <p id="roomId-show"></p>
    </div>

    <div>
      <a type="button" onclick="GetCurrentEstimationResult()">&nbsp; Show estimations &nbsp;</a>
      <a type="button" onclick="Reset()">&nbsp; Reset &nbsp;</a>
    </div>

    <div>
      Estimation Result:
      <p id="estimation-result-content">There is the result.</p>
    </div>
  </div>

  <div class="host-panel">
    Share the link below to join the room: <br/>
    <input class="link-show" type="text" id="room-link"> <br/>
    <button onclick="copySharedLink()">Copy</button><br>
  </div>
</div>